<html><head>
<base target="_top"/>
<title>United States Patent: 9336155</title></head>
<!---BUF1=9336155
BUF7=2016
BUF8=36971
BUF9=/1/
BUF51=9
---->
<body bgcolor="#FFFFFF">
<a name="top"></a>
<center>
<img alt="[US Patent &amp; Trademark Office, Patent Full Text and Image Database]" src="/netaicon/PTO/patfthdr.gif"/>
<br/>
<table>
<tbody><tr><td align="center">
<a href="/netahtml/PTO/index.html"><img alt="[Home]" border="0" src="/netaicon/PTO/home.gif" valign="middle"/></a>
<a href="/netahtml/PTO/search-bool.html"><img alt="[Boolean Search]" border="0" src="/netaicon/PTO/boolean.gif" valign="middle"/></a>
<a href="/netahtml/PTO/search-adv.htm"><img alt="[Manual Search]" border="0" src="/netaicon/PTO/manual.gif" valign="middle"/></a>
<a href="/netahtml/PTO/srchnum.htm"><img alt="[Number Search]" border="0" src="/netaicon/PTO/number.gif" valign="middle"/></a>
<a href="/netahtml/PTO/help/help.htm"><img alt="[Help]" border="0" src="/netaicon/PTO/help.gif" valign="middle"/></a>
</td></tr>
<tr><td align="center">
   <a href="/netacgi/nph-Parser?Sect1=PTO2&amp;Sect2=HITOFF&amp;u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&amp;r=617&amp;f=S&amp;l=50&amp;d=PTXT&amp;s1=facebook&amp;p=12&amp;Query=facebook"><img alt="[PREV_LIST]" border="0" src="/netaicon/PTO/prevlist.gif" valign="MIDDLE"/></a>
<a href="/netacgi/nph-Parser?Sect1=PTO2&amp;Sect2=HITOFF&amp;u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&amp;r=617&amp;f=S&amp;l=50&amp;d=PTXT&amp;s1=facebook&amp;p=13&amp;Query=facebook"><img alt="[HIT_LIST]" border="0" src="/netaicon/PTO/hitlist.gif" valign="MIDDLE"/></a>
<a href="/netacgi/nph-Parser?Sect1=PTO2&amp;Sect2=HITOFF&amp;u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&amp;r=617&amp;f=S&amp;l=50&amp;d=PTXT&amp;s1=facebook&amp;p=14&amp;Query=facebook"><img alt="[NEXT_LIST]" border="0" src="/netaicon/PTO/nextlist.gif" valign="MIDDLE"/></a>
<a href="/netacgi/nph-Parser?Sect1=PTO2&amp;Sect2=HITOFF&amp;u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&amp;r=616&amp;f=G&amp;l=50&amp;d=PTXT&amp;s1=facebook&amp;p=13&amp;OS=facebook"><img alt="[PREV_DOC]" border="0" src="/netaicon/PTO/prevdoc.gif" valign="MIDDLE"/></a>
<a href="/netacgi/nph-Parser?Sect1=PTO2&amp;Sect2=HITOFF&amp;u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&amp;r=618&amp;f=G&amp;l=50&amp;d=PTXT&amp;s1=facebook&amp;p=13&amp;OS=facebook"><img alt="[NEXT_DOC]" border="0" src="/netaicon/PTO/nextdoc.gif" valign="MIDDLE"/></a>

<a href="#bottom"><img alt="[Bottom]" border="0" src="/netaicon/PTO/bottom.gif" valign="middle"/></a>
</td></tr>
   <tr><td align="center">
   <a href="http://ebiz1.uspto.gov/vision-service/ShoppingCart_P/ShowShoppingCart?backUrl1=http%3A//patft.uspto.gov/netacgi/nph-Parser?Sect1%3DPTO2%26Sect2%3DHITOFF%26u%3D%25252Fnetahtml%25252FPTO%25252Fsearch-adv.htm%26r%3D617%26f%3DG%26l%3D50%26d%3DPTXT%26s1%3Dfacebook%26p%3D13%26OS%3Dfacebook&amp;backLabel1=Back%20to%20Document%3A%209336155"><img alt="[
View Shopping Cart]" border="0" src="/netaicon/PTO/cart.gif" valign="middle"/></a>
   <a href="http://ebiz1.uspto.gov/vision-service/ShoppingCart_P/AddToShoppingCart?docNumber=9336155&amp;backUrl1=http%3A//patft.uspto.gov/netacgi/nph-Parser?Sect1%3DPTO2%26Sect2%3DHITOFF%26u%3D%25252Fnetahtml%25252FPTO%25252Fsearch-adv.htm%26r%3D617%26f%3DG%26l%3D50%26d%3DPTXT%26s1%3Dfacebook%26p%3D13%26OS%3Dfacebook&amp;backLabel1=Back%20to%20Document%3A%209336155">
   <img alt="[Add to Shopping Cart]" border="0" src="/netaicon/PTO/order.gif" valign="middle"/></a>
   </td></tr>
   <tr><td align="center">
   <a href="http://pdfpiw.uspto.gov/.piw?Docid=09336155&amp;homeurl=http%3A%2F%2Fpatft.uspto.gov%2Fnetacgi%2Fnph-Parser%3FSect1%3DPTO2%2526Sect2%3DHITOFF%2526u%3D%25252Fnetahtml%25252FPTO%25252Fsearch-adv.htm%2526r%3D617%2526f%3DG%2526l%3D50%2526d%3DPTXT%2526s1%3Dfacebook%2526p%3D13%2526OS%3Dfacebook%2526RS%3Dfacebook&amp;PageNum=&amp;Rtype=&amp;SectionNum=&amp;idkey=NONE&amp;Input=View+first+page"><img alt="[Image]" border="0" src="/netaicon/PTO/image.gif" valign="middle"/></a>

   </td></tr>
</tbody></table>
</center>
<table width="100%">
<tbody><tr><td align="left" width="50%"> </td>
<td align="right" valign="bottom" width="50%"><font size="-1">( <strong>617</strong></font> <font size="-2">of</font> <strong><font size="-1">7895</font></strong> <font size="-1">)</font></td></tr></tbody></table>
<hr/>
   <table width="100%">
   <tbody><tr>	<td align="left" width="50%"><b>United States Patent </b></td>
   <td align="right" width="50%"><b>9,336,155</b></td>
   </tr>
     <tr><td align="left" width="50%"><b>
         Jia
,   et al.</b>
     </td>
     <td align="right" width="50%"> <b>
     May 10, 2016
</b></td>
     </tr>
     </tbody></table>
       <hr/>
       <font size="+1">Statistical cache promotion
</font><br/>
       <br/><center><b>Abstract</b></center>
       <p> Storing data in a cache is disclosed. It is determined that a data record
     is not stored in a cache. A random value is generated using a threshold
     value. It is determined whether to store the data record in the cache
     based at least in part on the generated random value.
</p>
       <hr/>
<table width="100%"> <tbody><tr> <th align="left" scope="row" valign="top" width="10%">Inventors:</th> <td align="left" width="90%">
 <b>Jia; Hongzhong</b> (Cupertino, CA)<b>, Liang; Xiaojun</b> (San Jose, CA)<b>, Taylor; Jason</b> (Berkeley, CA) </td> </tr>
<tr><th align="left" scope="row" valign="top" width="10%">Applicant: </th><td align="left" width="90%"> <table> <tbody><tr> <th align="center" scope="column">Name</th> <th align="center" scope="column">City</th> <th align="center" scope="column">State</th> <th align="center" scope="column">Country</th> <th align="center" scope="column">Type</th> </tr> <tr> <td> <b><br/><b><i>Facebook,</i></b> Inc.</b> </td><td> <br/>Menlo Park </td><td align="center"> <br/>CA </td><td align="center"> <br/>US </td> <td align="left"> </td>
</tr> </tbody></table>
<!-- AANM>
~AANM <B><I>Facebook,</I></B> Inc.
~AACI Menlo Park
~AAST CA
~AACO US
</AANM -->
</td></tr>
<tr> <th align="left" scope="row" valign="top" width="10%">Assignee:</th>
<td align="left" width="90%">

<b><a href="#h2" name="h3"></a><a href="#h4"></a><b><i>Facebook,</i></b> Inc.</b>
 (Menlo Park, 
CA)
<br/>

</td>
</tr>
       <tr><th align="left" nowrap="" scope="row" valign="top" width="10%">Family ID:
       </th><td align="left" width="90%">
       <b>50189121
</b></td></tr>
       <tr><th align="left" nowrap="" scope="row" valign="top" width="10%">Appl. No.:
       </th><td align="left" width="90%">
       <b>14/841,518</b></td></tr>
       <tr><th align="left" scope="row" valign="top" width="10%">Filed:
       </th><td align="left" width="90%">
       <b>August 31, 2015</b></td></tr>
     </tbody></table>
<hr/> <center><b>Prior Publication Data</b></center> <hr/> <table width="100%"> <tbody><tr><th scope="col"></th><th scope="col"></th><td></td></tr> <tr><td align="left">
</td><th align="center" scope="col"><b><u>Document Identifier</u></b></th><th align="center" scope="col"><b><u>Publication Date</u></b></th></tr><tr><td align="center"> </td><td align="center"> US 20150370718 A1</td><td align="center">Dec 24, 2015</td></tr><tr><td align="center"> 
</td>
</tr> </tbody></table>
<hr/> <center><b>Related U.S. Patent Documents</b></center> <hr/> <table width="100%"> <tbody><tr><th scope="col" width="7%"></th><th scope="col"></th><th scope="col"></th> <th scope="col"></th><th scope="col"></th><td></td></tr> <tr><td align="left">
</td><th align="center" scope="col"><b><u>Application Number</u></b></th><th align="center" scope="col"><b><u>Filing Date</u></b></th><th align="center" scope="col"><b><u>Patent Number</u></b></th><th align="center" scope="col"><b><u>Issue Date</u></b></th></tr><tr><td align="center"> </td><td align="center">14490539</td><td align="center">Sep 18, 2014</td><td align="center">9158707</td><td align="center"></td></tr><tr><td align="center"> </td><td align="center">13602639</td><td align="center">Oct 21, 2014</td><td align="center">8868841</td><td align="center"></td></tr><tr><td align="center"> 
</td>
</tr> </tbody></table><td< td=""></td<><td< td=""></td<><td< td=""></td<>     <hr/>
<p> <table width="100%"> <tbody><tr><td align="left" valign="top" width="30%"><b>Current U.S. Class:</b></td> <td align="right" valign="top" width="70%"><b>1/1</b> </td></tr> 
       <tr><td align="left" valign="top" width="30%"><b>Current CPC Class: </b></td>
       <td align="right" valign="top" width="70%">G06F 12/122 (20130101); G06F 12/0888 (20130101); G06F 12/0897 (20130101); G06F 2212/283 (20130101); G06F 2212/69 (20130101); G06F 2212/604 (20130101)</td></tr>
         <tr><td align="left" valign="top" width="30%"><b>Current International Class: </b></td>
         <td align="right" valign="top" width="70%">G06F 12/00 (20060101); G06F 12/12 (20160101); G06F 12/08 (20160101); G06F 13/00 (20060101)</td></tr>
       <tr><td align="left" valign="top" width="30%"><b>Field of Search: </b></td>
       <td align="right" valign="top" width="70%">
       





 ;711/100,117,118,133,154,200
       </td></tr>
     </tbody></table>
</p><hr/><center><b>References Cited  <a href="/netacgi/nph-Parser?Sect1=PTO2&amp;Sect2=HITOFF&amp;p=1&amp;u=%2Fnetahtml%2Fsearch-adv.htm&amp;r=0&amp;f=S&amp;l=50&amp;d=PALL&amp;Query=ref/9336155">[Referenced By]</a></b></center>       <hr/>
       <center><b>U.S. Patent Documents</b></center>
<table width="100%"> <tbody><tr><th scope="col" width="33%"></th> <th scope="col" width="33%"></th> <th scope="col" width="34%"></th></tr> <tr> <td align="left">
<a href="/netacgi/nph-Parser?Sect2=PTO1&amp;Sect2=HITOFF&amp;p=1&amp;u=%2Fnetahtml%2FPTO%2Fsearch-bool.html&amp;r=1&amp;f=G&amp;l=50&amp;d=PALL&amp;RefSrch=yes&amp;Query=PN%2F6845344">6845344</a></td><td align="left">
January 2005</td><td align="left">
Lally</td></tr><tr><td align="left">
<a href="/netacgi/nph-Parser?Sect2=PTO1&amp;Sect2=HITOFF&amp;p=1&amp;u=%2Fnetahtml%2FPTO%2Fsearch-bool.html&amp;r=1&amp;f=G&amp;l=50&amp;d=PALL&amp;RefSrch=yes&amp;Query=PN%2F6865514">6865514</a></td><td align="left">
March 2005</td><td align="left">
Goguen</td></tr><tr><td align="left">
<a href="/netacgi/nph-Parser?Sect2=PTO1&amp;Sect2=HITOFF&amp;p=1&amp;u=%2Fnetahtml%2FPTO%2Fsearch-bool.html&amp;r=1&amp;f=G&amp;l=50&amp;d=PALL&amp;RefSrch=yes&amp;Query=PN%2F6996678">6996678</a></td><td align="left">
February 2006</td><td align="left">
Sharma</td></tr><tr><td align="left">
<a href="http://appft.uspto.gov/netacgi/nph-Parser?TERM1=20130212296&amp;Sect1=PTO1&amp;Sect2=HITOFF&amp;d=PG01&amp;p=1&amp;u=%2Fnetahtml%2FPTO%2Fsrchnum.html&amp;r=0&amp;f=S&amp;l=50" target="_blank">2013/0212296</a></td><td align="left">
August 2013</td><td align="left">
Goel</td></tr><tr><td align="left">

</td>
</tr> </tbody></table>
       <i>Primary Examiner:</i> Thai; Tuan
<br/>
       <i>Attorney, Agent or Firm:</i> <coma>Van Pelt, Yi &amp; James LLP
<br/>
       <hr/>
       <center><b><i>Parent Case Text</i></b></center>
       <hr/>
       <br/><br/>CROSS REFERENCE TO OTHER APPLICATIONS
<br/><br/> This application is a continuation of co-pending U.S. patent application
     Ser. No. 14/490,539, entitled STATISTICAL CACHE PROMOTION filed Sep. 18,
     2014, which is a continuation of U.S. patent application Ser. No.
     13/602,639, now U.S. Pat. No. 8,868,841, entitled STATISTICAL CACHE
     PROMOTION filed Sep. 4, 2012 which is incorporated herein by reference
     for all purposes.
         <hr/>
<center><b><i>Claims</i></b></center> <hr/> <br/><br/>What is claimed is: <br/><br/> 1.  A system for storing data in a cache, comprising: a processor configured to: determine that a data record is not stored in a cache;  generate a random value using a
threshold value;  and determine whether to store the data record in the cache based at least in part on the generated random value;  wherein the threshold value has been determined based at least in part on an attribute of the cache;  and a memory
coupled to the processor and configured to provide the processor with instructions.
<br/><br/> 2.  The system of claim 1, wherein the threshold value is associated with a desired probability that the data record will be stored in the cache.
<br/><br/> 3.  The system of claim 2, wherein the desired probability is associated with an inverse value of the threshold value.
<br/><br/> 4.  The system of claim 1, wherein the attribute of the cache includes an observed data access pattern of a data set that includes the data record.
<br/><br/> 5.  The system of claim 1, wherein the attribute of the cache includes a data pattern value that represents a desired average number of times the data record is accessed and not stored in the cache before the data record is stored in the cache.
<br/><br/> 6.  The system of claim 1, wherein the attribute of the cache includes a size of the cache.
<br/><br/> 7.  The system of claim 1, wherein the attribute of the cache includes a hierarchy level of the cache.
<br/><br/> 8.  The system of claim 1, wherein in the event it is determined to store the data record in the cache, the processor is further configured to select an existing data record stored in the cache to be replaced with the data record to be stored in
the cache.
<br/><br/> 9.  The system of claim 1, wherein generating the random value is associated with a probabilistic determination on whether to store the data record in the cache.
<br/><br/> 10.  The system of claim 1, wherein determining whether to store the data record in the cache based at least in part on the generated random value includes comparing the random value with a reference value.
<br/><br/> 11.  The system of claim 1, wherein determining whether to store the data record in the cache includes comparing a reference value with a result of the random value modulo the threshold value.
<br/><br/> 12.  The system of claim 11, wherein it is determined to store the data record in the cache if the result matches the reference value.
<br/><br/> 13.  A method for storing data in a cache, comprising: determining that a data record is not stored in a cache;  generating a random value using a threshold value;  and determining whether to store the data record in the cache based at least in
part on the generated random value;  wherein the threshold value has been determined based at least in part on an attribute of the cache.
<br/><br/> 14.  The method of claim 13, wherein the threshold value is associated with a desired probability that the data record will be stored in the cache.
<br/><br/> 15.  The method of claim 14, wherein the desired probability is associated with an inverse value of the threshold value.
<br/><br/> 16.  The method of claim 13, wherein determining whether to store the data record in the cache based at least in part on the generated first random value includes comparing the random value with a reference value.
<br/><br/> 17.  The method of claim 13, wherein the attribute of the cache includes a data pattern value that represents a desired average number of times the data record is accessed and not stored in the cache before the data record is stored in the
cache.
<br/><br/> 18.  A computer program product for storing data, the computer program product being embodied in a non-transitory computer readable storage medium and comprising computer instructions for: determining that a data record is not stored in a
storage;  generating a random value using a threshold value;  and determining whether to store the data record in the storage based at least in part on the generated random value;  wherein the threshold value has been determined based at least in part on
an attribute of the storage.
<br/><br/> 19.  The computer program product of claim 18, wherein the threshold value is associated with a desired probability that the data record will be stored in the storage.
<br/><br/> 20.  The computer program product of claim 19, wherein the desired probability is associated with an inverse value of the threshold value. <hr/> <center><b><i>Description</i></b></center> <hr/> <br/><br/>BACKGROUND OF THE INVENTION
<br/><br/> Caches allow data to be stored at a location that enables faster access to the data.  For example, the cache may be a faster storage and/or located closer to a desired location.  Often caches are smaller in size to be cost effective and
efficient in performance.  This requires the data stored in the cache to be a duplicate store of an original data stored elsewhere in a larger storage.  If a requested data is stored in a cache, the requested data can be provided using the data in the
cache.  However, if the requested data is not stored in the cache, the data has to often be obtained from another slower cache and/or an original repository of the data, all of which are comparatively slower.  Thus, it is desirable to serve data requests
from the fastest cache as often as possible by placing in the cache data that will be likely requested in the future.  One way of predicting which data might be requested from the cache is to place in the cache the data that has been utilized the most in
the past.  Previously, determining the most utilized data required storing a counter for each data that may be placed in the cache and iterating the counter every time an associated data is accessed.  However, storing and maintaining a counter for each
potentially accessed data consumes valuable storage and computing resources.  Therefore there exists a need for a better way to determine which data to store in a cache. <br/><br/>BRIEF DESCRIPTION OF THE DRAWINGS
<br/><br/> Various embodiments of the invention are disclosed in the following detailed description and the accompanying drawings.
<br/><br/> FIG. 1 is a block diagram illustrating an embodiment of a system for caching data.
<br/><br/> FIG. 2 is a flow chart illustrating an embodiment of a process for processing a request for a data record.
<br/><br/> FIG. 3 is a flow chart illustrating an embodiment of a process for determining whether to cache a data record in a cache storage.
<br/><br/> FIG. 4 is a flow chart illustrating an embodiment of a process for determining a threshold value.
<br/><br/>DETAILED DESCRIPTION
<br/><br/> The invention can be implemented in numerous ways, including as a process; an apparatus; a system; a composition of matter; a computer program product embodied on a computer readable storage medium; and/or a processor, such as a processor
configured to execute instructions stored on and/or provided by a memory coupled to the processor.  In this specification, these implementations, or any other form that the invention may take, may be referred to as techniques.  In general, the order of
the steps of disclosed processes may be altered within the scope of the invention.  Unless stated otherwise, a component such as a processor or a memory described as being configured to perform a task may be implemented as a general component that is
temporarily configured to perform the task at a given time or a specific component that is manufactured to perform the task.  As used herein, the term `processor` refers to one or more devices, circuits, and/or processing cores configured to process
data, such as computer program instructions.
<br/><br/> A detailed description of one or more embodiments of the invention is provided below along with accompanying figures that illustrate the principles of the invention.  The invention is described in connection with such embodiments, but the
invention is not limited to any embodiment.  The scope of the invention is limited only by the claims and the invention encompasses numerous alternatives, modifications and equivalents.  Numerous specific details are set forth in the following
description in order to provide a thorough understanding of the invention.  These details are provided for the purpose of example and the invention may be practiced according to the claims without some or all of these specific details.  For the purpose
of clarity, technical material that is known in the technical fields related to the invention has not been described in detail so that the invention is not unnecessarily obscured.
<br/><br/> Determining whether to store a data record in a cache is disclosed.  In some embodiments, the stored data record may be any type of data including a database record, a key-value pair, a file, a text, a value, an image, and any other type of
data.  In some embodiments, when it is determined that a requested data record is not stored in a cache, it is determined whether the requested data record should be placed in the cache to serve a future request for the data record.  For the requested
data record, a random value is generated using a determined and/or provided threshold value.  Based at least in part on the random value, it is determined whether to store the data record in the cache.  In some embodiments, if the random value and/or a
calculation performed using the random value matches a predetermined value, the data record is stored in the cache.  For example, the probability that the random value and/or a calculation performed using the random value matches the predetermined value
approximates a desired probability that the data record should be stored in the cache each time a determination is made.  In some embodiments, a frequently accessed data record will have a higher probability of being placed in the cache than an
infrequently accessed data record because each time a data record that is not stored in the cache is requested, another probabilistic determination is made on whether to store the data record in the cache.  Each time an additional probabilistic
determination is made on whether to store the data record in the cache, the overall probability that the data record will be stored in the cache increases.  In some embodiments, the threshold value that is used to determine the random value controls the
likelihood the data record will be stored in the cache.  The threshold value may be determined dynamically and/or predetermined based on an observed data access pattern.  In some embodiments, the threshold value is determined based at least in part on a
size and/or hierarchy level of a cache of interest.
<br/><br/> FIG. 1 is a block diagram illustrating an embodiment of a system for caching data.  Requestor 102 requests a data record from cache manager 104.  Examples of requestor 102 include any hardware or software system, component, process, and/or
application.  Cache manager 104 manages storage grouping 106.  Cache manager 104 may include one or more hardware or software systems, components, processes, and/or applications.  In some embodiments, managing storage grouping 106 includes obtaining,
reading, storing, writing, removing, deleting, and/or replacing data in storage grouping 106.  Storage grouping 106 includes L1 cache 108, L2 cache 112 and storage 114.  The components included in storage grouping 106 may be included in one or more
physically separate systems.  For example, L1 cache 108 and L2 cache 112 may be included in different physical systems.  An example of storage grouping 106 has been shown in FIG. 1 to illustrate an example of at least a portion of caches and storages
that may contain a data requested by requested by requestor 102 and/or components at least in part managed by cache manager 104.  In the example shown, L1 cache 108 is the first cache level, L2 cache 112 is the second cache level, and storage 114 is the
backing repository that contains the potential data that may be stored in the caches.  For example, when a data is requested by requestor 102, cache manager 104 first checks L1 cache 108 to determine whether the requested data is stored in L1 cache 108. 
If the requested data is stored in L1 cache 108, the requested data is provided from L1 cache 108.  If the requested data is not stored in L1 cache 108, cache manager checks L2 cache 112 to determine whether the requested data is stored in the L2 cache. 
If the requested data is not stored in L2 cache 112, the requested data is obtained from storage 114 and provided to the requestor.  In some embodiments, whenever a requested data is determined to be not stored in cache, cache manager 104 determines
whether the requested data should be stored in the cache to serve a future request.  In some embodiments, cache manager 104 determines which requested data must be cached and which requested data is not required to be cached.  For example, cache manager
104 is configured to cache all requested data of a predetermined type, and if the requested data is not of the predetermined type, cache manager 104 makes a probabilistic determination on whether to cache the request data.
<br/><br/> In various embodiments, other levels of caches may exist.  For example, cache level(s) above L1 cache 108 and/or cache level(s) below L2 cache 112 may exist.  These additional cache levels may be managed by cache manager 104 and/or another cache
manager.  In some embodiments, L1 cache 108 is associated with a faster performance (e.g., access time, transfer rate, write/read speed, etc.) as compared to L2 cache 112.  In some embodiments, L2 cache 112 is associated with a faster performance as
compared to storage 114.  In some embodiments, L1 cache 108 is smaller in size as compared to the size of L2 cache 112.  In some embodiments, L2 cache 112 is smaller in size as compared to the size of storage 114.  Examples of storage 114 include a
database, a production storage, a backup storage, a physical disk, a flash storage, a memory, a hard driver, a storage media, and/or any medium for storing data.  Examples of L1 cache 108 and/or L2 cache 112 include a memory, a flash storage, a processor
cache, and any other medium for storing data.
<br/><br/> In various embodiments, the components shown in FIG. 1 may exist in various combinations of hardware machines.  One or more of the components shown in FIG. 1 may be included in the same machine.  For example, cache manager 104 and storage group
106 may be included in the same server.  In the example shown in FIG. 1, portions of the communication path between the components are shown.  Other communication paths may exist and the example of FIG. 1 has been simplified to illustrate the example
clearly.  The components of FIG. 1 may communicate with another component via a network.  Examples of the network include one or more of the following: a direct or indirect physical communication connection, mobile communication network, Internet,
intranet, Local Area Network, Wide Area Network, Storage Area Network, and any other form of connecting two or more systems, components, or storage devices together.  Although single instances of components have been shown to simplify the diagram,
additional instances of any of the components shown in FIG. 1 may exist.  For example, additional instances of L1 cache and/or L2 cache that store data in storage 114 may exist.  These additional caches may be managed by cache manager 104 and/or a
different cache manager in a system different from a system containing cache manager 104.  For example, cache manager 104 is included in a first system that includes L1 cache 108 and a second system that includes another cache manager and another L1
cache that are a part of the caching hierarchically associated with the same L2 cache 112 and storage 114.  Components not shown in FIG. 1 may also exist.
<br/><br/> FIG. 2 is a flow chart illustrating an embodiment of a process for processing a request for a data record.  In some embodiments, the process of FIG. 2 is implemented in cache manager 104 of FIG. 1.
<br/><br/> At 202, a request for a data record is received.  In some embodiments, the request is received from a requestor such as requestor 102 of FIG. 1.  The requested data record may be any type of data including a database record, a key-value pair, a
file, a text, a value, an image, and any other type of data.
<br/><br/> At 204, it is determined whether the requested data record is stored in an L1 cache.  In some embodiments, the L1 cache is included in L1 cache 108 of FIG. 1.  If at 204 it is determined that the requested data record is stored in the L1 cache,
at 206, the requested data record stored in the L1 cache is obtained from the L1 cache and returned to the requester.  If at 204 it is determined that the requested data record is not stored in the L1 cache, at 208, it is determined whether the requested
data record is stored in an L2 cache.  In some embodiments, the L2 cache is included in L2 cache 112 of FIG. 1.
<br/><br/> If at 208 it is determined that the requested data record is stored in the L2 cache, at 210, the requested data record stored in the L2 cache is obtained from the L2 cache and returned to the requester.
<br/><br/> At 212, it is determined whether to cache/store the requested data record in the L1 cache and the requested data record is cached in the L1 cache, if applicable.  In some embodiments, determining whether to cache the data record includes
determining a random value used to make a probabilistic determination on whether to store the requested data record in the L1 cache.  In some embodiments, caching the data record in the L1 cache includes evicting/removing/replacing a previously stored
data record in the L1 cache.  In various embodiments, the previously stored data record is selected based on a time/order indicator (e.g., associated with when the data record has been last accessed and/or placed in the cache), a least recently used
(LRU) order, last-in-first-out order (LIFO), first-in-first-out order (FIFO), and/or a random order.
<br/><br/> If at 208 it is determined that the requested data record is not stored in the L2 cache, at 214, the requested data record is obtained from a source storage and returned to the requester.  In some embodiments, the source storage is included in
storage 114 of FIG. 1.  In other embodiments, one or more other levels of cache or other cache may exist and these cache(s) are checked before the requested data is obtained from the source storage.
<br/><br/> At 216, it is determined whether to cache/store the requested data record in the L2 cache and the requested data record is cached in the L2 cache, if applicable.  In some embodiments, determining whether to cache the data record includes
determining a random value used to make a probabilistic determination on whether to store the requested data record in the L2 cache.  In some embodiments, caching the data record in the L2 cache includes evicting/removing/replacing a previously stored
data record in the L2 cache.  In various embodiments, the previously stored data record is selected based on a time indicator (e.g., associated with when the data record has been last accessed and/or placed in the cache), least recently used (LRU),
last-in-first-out order (LIFO), first-in-first-out order (FIFO), and/or a random order.  In some embodiments, at 216, it is also determined whether to cache/store the requested data record in the L1 cache and the requested data record is cached in the L1
cache, if applicable.
<br/><br/> FIG. 3 is a flow chart illustrating an embodiment of a process for determining whether to cache a data record in a cache storage.  In some embodiments, the process of FIG. 3 is implemented in cache manager 104 of FIG. 1.  In some embodiments,
the process of FIG. 3 is included in step 212 and/or 216 of FIG. 2.
<br/><br/> At 302, a random value associated with a potential data record to be stored in a cache is determined.  In some embodiments, the cache includes L1 cache 108 of FIG. 1.  In some embodiments, the cache includes L2 cache 112 of FIG. 1.  In some
embodiments, determining the random value includes determining a random value bound by a predetermined threshold value.  For example, a random integer value between 1 and a threshold value is determined.  In some embodiments, the random value is
associated with a statistical probability the data record should be stored in the cache each time it is determined that the data record has been requested but not stored in the cache.  The threshold value may be configured to adjust the statistical
probability that the data record will be stored in the cache.  In some embodiments, the threshold value is predetermined.  In some embodiments, the threshold value is dynamically determined.  In some embodiments, the threshold value is determined based
at least in part on an analysis of a historical access pattern of one or more data records in a data set.  For example, number of accesses for each data record in the data set is determined and used to determine the threshold value.  In some embodiments,
the random value and/or threshold value is based at least in part on a storage size and/or hierarchy level of the cache.  In some embodiments, the random value must be an integer value.  In some embodiments, the threshold value is based at least in part
on a probabilistic function to be used for a particular cache.  For example, each cache level of a plurality of cache levels is associated with a different probabilistic function used to determine whether to cache the data record in the particular cache
level, and the probabilistic function for each cache level is associated with a different threshold value.
<br/><br/> At 304, a comparison value based on the random value is compared with a reference value.  In some embodiments, the comparison value is the random value.  In some embodiments, the comparison value is computed using the random value.  For example,
the comparison value is the random value modulo the threshold value.  In some embodiments, the reference value is a predetermined value that represents the value of the comparison value if the data record should be stored in the cache.  In some
embodiments, performing the comparison includes determining whether the comparison value equals the reference value.  Other comparisons such as greater than, less than, greater than or equal to, or less than or equal to comparisons may be performed.  In
some embodiments, the statistical probability that the comparison value is of a certain comparison (e.g., equal to) as compared to the reference value is associated with the probability that the data record of interest should be stored in the cache.  For
example, the random value must be an integer value between 1 and a threshold value, and if the comparison value (e.g., the random value modulo the threshold value) equals the reference value (e.g., integer value of 1), the data record of interest is to
be stored in the cache.  Otherwise, the data record of interest is not yet to be stored in the cache.
<br/><br/> At 306, if it is determined that a result of the comparison matches a criteria, at 308, it is determined to store the data record of interest in the cache.  In some embodiments, matching the criteria includes determining whether in step 304 the
comparison value matches a reference value.  In some embodiments, storing the data record in the cache includes replacing and/or removing an existing data record stored in the cache.  The existing data record to be replaced/removed may be selected based
on a time indicator (e.g., associated with when the data record has been last accessed and/or placed in the cache), least recently used (LRU), last-in-first-out order (LIFO), first-in-first-out order (FIFO), and/or a random order.
<br/><br/> At 306, if it is determined that a result of the comparison does not match a criteria, at 310, it is determined not to store the data record of interest in the cache.  In some embodiments, the criteria does not match because in step 304 the
comparison value does not match a reference value.
<br/><br/> FIG. 4 is a flow chart illustrating an embodiment of a process for determining a threshold value.  In some embodiments, the process of FIG. 4 is implemented in cache manager 104 of FIG. 1.  In some embodiments, the process of FIG. 4 is included
in step 212 and/or 216 of FIG. 2.  In some embodiments, the process of FIG. 4 is included in step 302 of FIG. 3.
<br/><br/> At 402, a data pattern of data records in a data set is analyzed.  In some embodiments, analyzing the data pattern includes obtaining/tracking a data access pattern.  For example, for a predetermined period of time, the number of times each
record in a data set is accessed is tracked.  In some embodiments, by tracking the data pattern of a data set for a limited period of time, an appropriate threshold value can be determined for the data set and a data access pattern.  In some embodiments,
analyzing the data set includes organizing, sorting, and/or processing the data pattern.  In some embodiments, the total number of unique data records that were accessed a given number of times or less is determined.  For example, it is determined that
90% of unique data records are accessed for no more than 32 times per day.  In some embodiments, the total number of data record accesses for data record(s) that were accessed a given number of times or less is determined.  For example, it is determined
that 79% of accesses are from the data records which are accessed for more than 32 times per day.  In some embodiments, performing analysis includes generating a graph or other visualization of the data record access pattern that can be used to determine
an access pattern value.
<br/><br/> At 404, an access pattern value is determined based on the analysis.  In some embodiments, determining the access pattern value includes determining a value that represents a desired average number of times the data record has been accessed and
not stored in the cache during a given amount of time before the data record is stored in a given level of cache.  For example, 32 is selected as the access pattern value because the analysis performed in step 402 determined that 90% of unique data
records are accessed for no more than 32 times per day and that 79% of accesses are from the data records which are accessed for more than 32 times per day.  In some embodiments, a plurality of access pattern values may be determined.  In some
embodiments, determining the access pattern value includes determining a value that represents a number of accesses during a given amount of time associated with a data record that should be stored in a given level of cache with a relatively low degree
of probability.  In some embodiments, determining the access pattern value includes determining a value that represents a number of accesses during a given amount of time associated with a data record that should be stored in a given level of cache with
a relatively higher degree of probability.  For example, it is determined that when the number of accesses of a given data record is 10, the probability the data record is stored in a certain cache should be relatively low (e.g., less than 30%), when the
number of accesses of the given data record is 32, the probability the data record is stored in a certain cache should be relatively high (e.g., around 60%), and when the number of accesses of the given data record is 100, the probability the data record
is stored in a certain cache should be relatively very high (e.g., greater than 90%).  In various embodiments, the access pattern value is determined using various probability density functions.  For example, the access pattern value is determined using
a binomial density function and/or another density function.
<br/><br/> At 406, using the access pattern value, a threshold value is determined.  In some embodiments, the determined threshold value is the threshold value used in step 212 and/or 216 of FIG. 2 and/or step 302 of FIG. 3.  For example, for each access
of a data record that is not stored in a given cache, the data record is stored in the given cache if a randomly generated integer between 1 and the threshold value (i.e., N) modulo N equals to 1.  This gives the probability of 1/N a data record is
stored in the given cache and (N-1)/N probability the data record is not stored in the cache.  As a data record is accessed more often, it has a greater chance to be promoted because the probabilistic determination of whether to store the data record in
the cache is performed each time the data record is accessed but not stored in the cache.  The calculation below shows the probability a data record will stored in the cache.
<br/><br/> Given:
<br/><br/> P(S=k) is the probability a data record is stored in a given cache when it gets accessed at k.sub.th time.
<br/><br/> P(F=k) is the probability a data record is not stored in a given cache when it gets accessed at k.sub.th time.
<br/><br/> The probability for each individual trial:
<br/><br/> ##EQU00001## where P.sub.s is the success probability and P.sub.f is the failure probability
<br/><br/> .function..function..function.  ##EQU00002##
<br/><br/> The cumulative probability:
<br/><br/> .function..ltoreq..function..function..function.  ##EQU00003##
<br/><br/> For example, the access pattern values of 10, 32, and 100 have been determined because it is determined that when the number of accesses of a given data record is 10, the probability the data record is stored in a certain cache should be
relatively low (e.g., less than 30%), when the number of accesses of the given data record is 32, the probability the data record is stored in a certain cache should be relatively high (e.g., around 60%), and when the number of accesses of the given data
record is 100, the probability the data record is stored in a certain cache should be relatively very high (e.g., greater than 90%).  Using these access pattern values and associated criteria, a threshold value of 32 (i.e., N=32) has been determined. 
Using the earlier calculated probability formula:
<br/><br/> .function..ltoreq..times.  ##EQU00004## .function..ltoreq..times.  ##EQU00004.2## .function..ltoreq..times.  ##EQU00004.3##
<br/><br/> This means that a data record has 24.85% probability to be stored in a cache with 10 accesses, 62.63% probability to be stored in the cache with 32 accesses and 95.69% probability to be stored in the cache with 100 accesses.  These values are
merely an example.  Other access pattern values and associated desired cache storage probability may be used.  In some embodiments, the threshold value may be determined at least in part based on a size and/or hierarchy level of the cache.  For example,
a lower probability of being stored in the cache is associated with a smaller and/or higher level cache (e.g., L1 cache) as compared to a larger and/or lower level cache (e.g., L2 cache).
<br/><br/> Although the foregoing embodiments have been described in some detail for purposes of clarity of understanding, the invention is not limited to the details provided.  There are many alternative ways of implementing the invention.  The disclosed
embodiments are illustrative and not restrictive.
<br/><br/><center><b>* * * * *</b></center>
<hr/>
   <center>
   <a href="http://pdfpiw.uspto.gov/.piw?Docid=09336155&amp;homeurl=http%3A%2F%2Fpatft.uspto.gov%2Fnetacgi%2Fnph-Parser%3FSect1%3DPTO2%2526Sect2%3DHITOFF%2526u%3D%25252Fnetahtml%25252FPTO%25252Fsearch-adv.htm%2526r%3D617%2526f%3DG%2526l%3D50%2526d%3DPTXT%2526s1%3Dfacebook%2526p%3D13%2526OS%3Dfacebook%2526RS%3Dfacebook&amp;PageNum=&amp;Rtype=&amp;SectionNum=&amp;idkey=NONE&amp;Input=View+first+page"><img alt="[Image]" border="0" src="/netaicon/PTO/image.gif" valign="middle"/></a>
   <table>
   <tbody><tr><td align="center"><a href="http://ebiz1.uspto.gov/vision-service/ShoppingCart_P/ShowShoppingCart?backUrl1=http%3A//patft.uspto.gov/netacgi/nph-Parser?Sect1%3DPTO2%26Sect2%3DHITOFF%26u%3D%25252Fnetahtml%25252FPTO%25252Fsearch-adv.htm%26r%3D617%26f%3DG%26l%3D50%26d%3DPTXT%26s1%3Dfacebook%26p%3D13%26OS%3Dfacebook&amp;backLabel1=Back%20to%20Document%3A%209336155"><img alt="[View Shopping Cart]" border="0" src="/netaicon/PTO/cart.gif" valign="middle"/></a>
   <a href="http://ebiz1.uspto.gov/vision-service/ShoppingCart_P/AddToShoppingCart?docNumber=9336155&amp;backUrl1=http%3A//patft.uspto.gov/netacgi/nph-Parser?Sect1%3DPTO2%26Sect2%3DHITOFF%26u%3D%25252Fnetahtml%25252FPTO%25252Fsearch-adv.htm%26r%3D617%26f%3DG%26l%3D50%26d%3DPTXT%26s1%3Dfacebook%26p%3D13%26OS%3Dfacebook&amp;backLabel1=Back%20to%20Document%3A%209336155">
   <img alt="[Add to Shopping Cart]" border="0" src="/netaicon/PTO/order.gif" valign="middle"/></a>
   </td></tr>
   <tr><td align="center">
     <a href="/netacgi/nph-Parser?Sect1=PTO2&amp;Sect2=HITOFF&amp;u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&amp;r=617&amp;f=S&amp;l=50&amp;d=PTXT&amp;s1=facebook&amp;p=12&amp;Query=facebook"><img alt="[PREV_LIST]" border="0" src="/netaicon/PTO/prevlist.gif" valign="MIDDLE"/></a>
<a href="/netacgi/nph-Parser?Sect1=PTO2&amp;Sect2=HITOFF&amp;u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&amp;r=617&amp;f=S&amp;l=50&amp;d=PTXT&amp;s1=facebook&amp;p=13&amp;Query=facebook"><img alt="[HIT_LIST]" border="0" src="/netaicon/PTO/hitlist.gif" valign="MIDDLE"/></a>
<a href="/netacgi/nph-Parser?Sect1=PTO2&amp;Sect2=HITOFF&amp;u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&amp;r=617&amp;f=S&amp;l=50&amp;d=PTXT&amp;s1=facebook&amp;p=14&amp;Query=facebook"><img alt="[NEXT_LIST]" border="0" src="/netaicon/PTO/nextlist.gif" valign="MIDDLE"/></a>
<a href="/netacgi/nph-Parser?Sect1=PTO2&amp;Sect2=HITOFF&amp;u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&amp;r=616&amp;f=G&amp;l=50&amp;d=PTXT&amp;s1=facebook&amp;p=13&amp;OS=facebook"><img alt="[PREV_DOC]" border="0" src="/netaicon/PTO/prevdoc.gif" valign="MIDDLE"/></a>
<a href="/netacgi/nph-Parser?Sect1=PTO2&amp;Sect2=HITOFF&amp;u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&amp;r=618&amp;f=G&amp;l=50&amp;d=PTXT&amp;s1=facebook&amp;p=13&amp;OS=facebook"><img alt="[NEXT_DOC]" border="0" src="/netaicon/PTO/nextdoc.gif" valign="MIDDLE"/></a>

   <a href="#top"><img alt="[Top]" border="0" src="/netaicon/PTO/top.gif" valign="middle"/></a>
   </td></tr>
   </tbody></table>
   <a name="bottom"></a>
   <a href="/netahtml/PTO/index.html"><img alt="[Home]" border="0" src="/netaicon/PTO/home.gif" valign="middle"/></a>
   <a href="/netahtml/PTO/search-bool.html"><img alt="[Boolean Search]" border="0" src="/netaicon/PTO/boolean.gif" valign="middle"/></a>
   <a href="/netahtml/PTO/search-adv.htm"><img alt="[Manual Search]" border="0" src="/netaicon/PTO/manual.gif" valign="middle"/></a>
   <a href="/netahtml/PTO/srchnum.htm"><img alt="[Number Search]" border="0" src="/netaicon/PTO/number.gif" valign="middle"/></a>
   <a href="/netahtml/PTO/help/help.htm"><img alt="[Help]" border="0" src="/netaicon/PTO/help.gif" valign="middle"/></a>
   </center>

</coma></body></html>